(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{9045:function(e,t,n){Promise.resolve().then(n.bind(n,8945))},8945:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return _}});var r=n(7437),a=n(2265),l=n(6887),s=n(6300).Buffer;let o="https://gfhtoiqsvrqbwzshjxgs.supabase.co",i="sb_secret_JJqba7_7fsm9gEOxDhol4Q_G9SU0gMR",c=e=>{if(!e)return"undefined";try{if(e.length<=12)return"****";let t=e.slice(0,4),n=e.slice(-4);return"".concat(t,"...").concat(n)}catch(e){return"****"}},d=function(e){if(!e)return!1;let t=e.split(".");if(t.length>=2){let e=function(e){try{let t=e.replace(/-/g,"+").replace(/_/g,"/"),n=t.length%4==0?"":"=".repeat(4-t.length%4);return s.from(t+n,"base64").toString("utf-8")}catch(e){return""}}(t[1]);if(/service_role/i.test(e)||/"role"\s*:\s*"service_role"/i.test(e))return!0}return!!/service_role/.test(e)}(i),u=d?"service_role_in_client_env":null;!function(){let e={urlHost:"unknown",anonMasked:c(i)};try{e.urlHost=o?new URL(o).host:"undefined"}catch(t){e.urlHost=o||"undefined"}o&&i?d?console.error("Service role key detected in client env; blocked",e):console.log("[Supabase] init",e):console.warn("Supabase env missing: using local fallback data",e)}();let p=o&&i&&!d?(0,l.eI)(o,i,{auth:{persistSession:!1}}):null;function f(e){let{table:t,op:n,status:r,error:a,responseBodySnippet:l}=e;console.error("[Supabase]",{table:t,op:n,status:null!=r?r:(null==a?void 0:a.status)||void 0,code:null==a?void 0:a.code,message:null==a?void 0:a.message,details:null==a?void 0:a.details,hint:null==a?void 0:a.hint,responseBodySnippet:l,raw:a})}let g={padding:"10px 12px",margin:"8px 0",borderRadius:6,fontSize:14,lineHeight:1.4},b={...g,background:"#fff3cd",color:"#664d03",border:"1px solid #ffecb5"},x={...g,background:"#f8d7da",color:"#842029",border:"1px solid #f5c2c7"},y={...g,background:"#d1e7dd",color:"#0f5132",border:"1px solid #badbcc"};function h(e){return e?"".concat(e.slice(0,4),"...").concat(e.slice(-4)):"undefined"}function v(e,t){let n=(null==t?void 0:t.code)||"",r=((null==t?void 0:t.message)||"")+" "+((null==t?void 0:t.details)||"");return 401===e||403===e||/42501/i.test(n)||/RLS|row-level security/i.test(r)}function m(e,t){return v(e,t)?"권한 정책(RLS)으로 인해 접근이 거부되었습니다. 관리자에게 문의하시거나 Supabase RLS 정책(SELECT/INSERT/UPDATE 등)을 확인해 주세요.":null}function S(){let[e,t]=(0,a.useState)([]),[n,l]=(0,a.useState)([]),[s,o]=(0,a.useState)("all"),[i,c]=(0,a.useState)(null),[d,g]=(0,a.useState)(!0),[S,_]=(0,a.useState)(""),[w,k]=(0,a.useState)("");(0,a.useEffect)(()=>{let e=!0;return async function(){try{if(u){console.error("[Security] Service role key detected in client env; all client-side Supabase calls are blocked.",{reason:u,url:h("https://gfhtoiqsvrqbwzshjxgs.supabase.co"),anon:h("sb_secret_JJqba7_7fsm9gEOxDhol4Q_G9SU0gMR")}),e&&(c({type:"error",text:"보안 경고: 브라우저 환경변수에서 service_role 키가 감지되어 호출이 차단되었습니다. 서비스 키는 ETL 전용이며, 프론트에 노출하면 안 됩니다."}),t([]),l([]),g(!1));return}if(!p){console.warn("[Supabase] client is null. Env missing or invalid. Falling back to in-memory data.",{url:h("https://gfhtoiqsvrqbwzshjxgs.supabase.co"),anon:h("sb_secret_JJqba7_7fsm9gEOxDhol4Q_G9SU0gMR")}),e&&(c({type:"warn",text:"Supabase 환경변수가 없거나 잘못되었습니다. 임시로 메모리 데이터로 동작하며 저장되지 않습니다."}),t([]),l([]),g(!1));return}try{let{data:t,error:n,status:r}=await p.from("categories").select("key").limit(1);if(n){f({table:"categories",op:"select(health)",status:r,error:n});let t=m(r,n)||"Supabase 연결/권한 확인 필요 (status=".concat(r,", error=").concat((null==n?void 0:n.message)||"").concat((null==n?void 0:n.details)?", details=".concat(null==n?void 0:n.details):"",").");e&&c({type:"warn",text:t})}else console.log("[Supabase][Health] OK",{rows:(t||[]).length})}catch(t){console.error("[Supabase][Health] unexpected",(null==t?void 0:t.message)||t),e&&c({type:"warn",text:"Supabase 헬스체크 중 예기치 않은 오류가 발생했습니다. 콘솔 로그를 확인하세요."})}try{let{data:n,error:r,status:a}=await p.from("categories").select("key,name").order("key",{ascending:!0});if(r){f({table:"categories",op:"select",status:a,error:r});let n=m(a,r)||"카테고리 로드 실패(status=".concat(a,"): ").concat((null==r?void 0:r.message)||"").concat((null==r?void 0:r.details)?", details=".concat(null==r?void 0:r.details):"");e&&(c({type:"warn",text:n}),t([]))}else e&&t(n||[])}catch(t){console.error("[Supabase][categories.select][unexpected]",(null==t?void 0:t.message)||t),e&&c({type:"warn",text:"카테고리 로드 중 예기치 않은 오류가 발생했습니다."})}try{let{data:t,error:n,status:r}=await p.from("places").select("id,name,category_key,lat,lng,image,description,time,fee,url,created_at").order("id",{ascending:!0});if(n){f({table:"places",op:"select",status:r,error:n});let t=m(r,n)||"장소 로드 실패(status=".concat(r,"): ").concat((null==n?void 0:n.message)||"").concat((null==n?void 0:n.details)?", details=".concat(null==n?void 0:n.details):"");e&&(c({type:"warn",text:t}),l([]))}else e&&l(t||[]),e&&c({type:"ok",text:"Supabase에서 데이터가 정상적으로 로드되었습니다."})}catch(t){console.error("[Supabase][places.select][unexpected]",(null==t?void 0:t.message)||t),e&&c({type:"warn",text:"장소 로드 중 예기치 않은 오류가 발생했습니다."})}}finally{e&&g(!1)}}(),()=>{e=!1}},[p]);let j=(0,a.useMemo)(()=>"all"===s?n:n.filter(e=>(e.category_key||"")===s),[n,s]);async function R(e){e.preventDefault();let t=S.trim(),n=w.trim()||null;if(!t){c({type:"warn",text:"이름을 입력해 주세요."});return}let r={name:t,category_key:n,description:"user-added"};if(u){l(e=>[...e,{...r,id:Date.now(),created_at:new Date().toISOString()}]),c({type:"error",text:"보안 경고: service_role 키 감지로 네트워크 호출이 차단되어, 메모리에만 추가되었습니다. 서비스 키는 브라우저에 노출하면 안 됩니다."}),_(""),k("");return}if(!p){console.warn("[Supabase] client is null, adding to local state only."),l(e=>[...e,{...r,id:Date.now(),created_at:new Date().toISOString()}]),c({type:"warn",text:"Supabase 비활성 상태. 로컬 메모리에만 추가되었습니다(새로고침 시 사라짐)."}),_(""),k("");return}try{let{data:e,error:t,status:n}=await p.from("places").insert([r]).select("id,name,category_key,lat,lng,image,description,time,fee,url,created_at");if(t){f({table:"places",op:"insert",status:n,error:t});let e="장소 추가 실패(status=".concat(n,"): ").concat(t.message||"");t.details&&(e+=", details=".concat(t.details)),v(n,t)?e="권한 정책(RLS)으로 인해 접근이 거부되었습니다. 관리자에게 문의해 주세요.":t.code&&/23503/.test(t.code)||/foreign key/i.test(t.message||"")?e="카테고리 키를 먼저 생성/선택하세요. (외래키 제약 조건 위반)":409===n&&(e="충돌이 발생했습니다(중복 등). 입력값을 확인해 주세요."),l(e=>[...e,{...r,id:Date.now(),created_at:new Date().toISOString()}]),c({type:"warn",text:"".concat(e," — 대신 메모리에만 추가되었습니다.")})}else{let t=e&&e[0]?e[0]:null;t&&l(e=>[...e,t]),c({type:"ok",text:"장소가 Supabase에 성공적으로 추가되었습니다."})}}catch(e){console.error("[Supabase][insert][unexpected]",(null==e?void 0:e.message)||e),l(e=>[...e,{...r,id:Date.now(),created_at:new Date().toISOString()}]),c({type:"warn",text:"예기치 않은 오류로 인해 메모리에만 추가되었습니다. 콘솔 로그를 확인하세요."})}finally{_(""),k("")}}return(0,r.jsxs)("div",{style:{padding:16},children:[(0,r.jsx)("h1",{children:"Jeju Travel Planner"}),(0,r.jsxs)("div",{style:{marginBottom:8},children:[i&&(0,r.jsx)("div",{style:"ok"===i.type?y:"warn"===i.type?b:x,children:i.text}),!p&&!u&&(0,r.jsxs)("div",{style:b,children:["Supabase URL/Anon이 설정되지 않았습니다. 현재 상태: url=",h("https://gfhtoiqsvrqbwzshjxgs.supabase.co"),", anon=",h("sb_secret_JJqba7_7fsm9gEOxDhol4Q_G9SU0gMR")]}),u&&(0,r.jsx)("div",{style:x,children:"보안 경고: service_role 키가 클라이언트 환경에서 감지되어 네트워크 호출이 중단되었습니다. 서비스 키는 오직 서버/ETL에서만 사용하세요."})]}),(0,r.jsx)("div",{style:{marginBottom:12,fontSize:13,color:"#555"},children:d?"로딩 중...":"카테고리 ".concat(e.length,"개, 장소 ").concat(n.length,"개")}),(0,r.jsxs)("div",{style:{display:"flex",gap:8,flexWrap:"wrap",marginBottom:12},children:[(0,r.jsx)("button",{type:"button",onClick:()=>o("all"),style:{padding:"6px 10px",borderRadius:16,border:"1px solid #ccc",background:"all"===s?"#e7f1ff":"#fff",cursor:"pointer"},children:"전체"}),e.map(e=>(0,r.jsx)("button",{type:"button",onClick:()=>o(e.key),style:{padding:"6px 10px",borderRadius:16,border:"1px solid #ccc",background:s===e.key?"#e7f1ff":"#fff",cursor:"pointer"},title:e.name||e.key,children:e.name||e.key},e.key))]}),(0,r.jsxs)("form",{onSubmit:R,style:{display:"flex",gap:8,flexWrap:"wrap",marginBottom:16},children:[(0,r.jsx)("input",{value:S,onChange:e=>_(e.target.value),placeholder:"새 장소 이름",style:{padding:"6px 8px",border:"1px solid #ccc",borderRadius:6}}),(0,r.jsx)("input",{value:w,onChange:e=>k(e.target.value),placeholder:"카테고리 키(예: nature)",style:{padding:"6px 8px",border:"1px solid #ccc",borderRadius:6}}),(0,r.jsx)("button",{type:"submit",style:{padding:"6px 10px",borderRadius:6,cursor:"pointer"},children:"장소 추가"})]}),(0,r.jsx)("div",{children:0===j.length?(0,r.jsx)("div",{style:{color:"#666",fontSize:14},children:"표시할 장소가 없습니다."}):(0,r.jsx)("ul",{style:{listStyle:"none",padding:0,margin:0},children:j.map(e=>{var t,n;return(0,r.jsxs)("li",{style:{padding:"8px 0",borderBottom:"1px solid #eee"},children:[(0,r.jsx)("div",{style:{fontWeight:600},children:e.name}),(0,r.jsxs)("div",{style:{fontSize:12,color:"#555"},children:["카테고리: ",e.category_key||"-",e.description?" • ".concat(e.description):""]}),e.url?(0,r.jsx)("div",{style:{fontSize:12},children:(0,r.jsx)("a",{href:e.url,target:"_blank",rel:"noreferrer",children:"링크"})}):null]},"".concat(null!==(t=e.id)&&void 0!==t?t:e.name,"-").concat(null!==(n=e.created_at)&&void 0!==n?n:""))})})})]})}function _(){return(0,r.jsx)(S,{})}}},function(e){e.O(0,[887,971,23,744],function(){return e(e.s=9045)}),_N_E=e.O()}]);